<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern CSS Carousel</title>
    <style>
        /* CSS Variables for Theming */
        :root {
            --primary-bg: #0a0a0a;
            --secondary-bg: #1a1a1a;
            --tertiary-bg: #2a2a2a;
            --primary-text: #ffffff;
            --secondary-text: #a0a0a0;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --border: rgba(255, 255, 255, 0.1);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            --hover-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --danger: #ef4444;
            --danger-hover: #dc2626;
        }

        .light-mode {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --tertiary-bg: #e9ecef;
            --primary-text: #1a1a1a;
            --secondary-text: #6c757d;
            --border: rgba(0, 0, 0, 0.1);
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(0, 0, 0, 0.05);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Header & Theme Toggle */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 800px;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-weight: bold;
            font-size: 1.25rem;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--tertiary-bg);
            border-radius: 15px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.3s;
            display: block;
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        #theme-switch:checked + .theme-toggle::after {
            transform: translateX(30px);
        }

        #theme-switch {
            display: none;
        }

        /* Main Container */
        .container {
            width: 100%;
            max-width: 800px;
        }

        /* Title Section */
        .title-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title-section h1 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .title-section p {
            color: var(--secondary-text);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Carousel Container */
        .carousel-container {
            position: relative;
            margin-bottom: 2rem;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            background: var(--secondary-bg);
        }

        /* Modern Carousel */
        .carousel {
            display: flex;
            gap: 1em;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding: 1.5rem;
            scrollbar-width: none;
            position: relative;
            scroll-snap-stop: always;
        }

        .carousel::-webkit-scrollbar {
            display: none;
        }

        /* Cards */
        .card {
            flex: 0 0 20em;
            scroll-snap-align: start;
            background: var(--tertiary-bg);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--hover-shadow);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
            z-index: 2;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        /* Image Container */
        .card-image-container {
            position: relative;
            overflow: hidden;
        }

        .card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
            cursor: zoom-in;
            transition: transform 0.3s;
        }

        .card:hover .card-image {
            transform: scale(1.05);
        }

        /* Delete Button - Hidden by default */
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-size: 1.2rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .delete-btn:hover {
            background: var(--danger-hover);
            transform: scale(1.1);
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        /* Desktop: Show on card hover */
        .card:hover .delete-btn {
            opacity: 1;
            transform: scale(1);
        }

        .card-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--primary-text);
        }

        .card-description {
            color: var(--secondary-text);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: auto;
        }

        .tag {
            background: var(--glass-bg);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--secondary-text);
            backdrop-filter: blur(10px);
        }

        /* Scroll Buttons - Fixed to viewport */
        .scroll-btn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transition: all 0.3s;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
        }

        .scroll-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .scroll-btn:hover:not(:disabled) {
            background: var(--accent-hover);
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.5);
        }

        .scroll-btn:active:not(:disabled) {
            transform: translateY(-50%) scale(0.95);
        }

        .scroll-btn:disabled {
            opacity: 0.3;
            cursor: auto;
            box-shadow: none;
        }

        .scroll-btn-left {
            left: 1rem;
        }

        .scroll-btn-right {
            right: 1rem;
        }

        /* Show buttons on carousel hover (desktop only) */
        @media (hover: hover) and (pointer: fine) {
            .carousel-container:hover .scroll-btn {
                opacity: 1;
                pointer-events: auto;
            }
        }

        /* Scroll Markers */
        .scroll-markers {
            display: flex;
            justify-content: center;
            gap: 0.5em;
            margin-top: 1rem;
            padding: 0.5rem;
            flex-wrap: wrap;
        }

        .scroll-marker {
            height: 12px;
            width: 12px;
            background-color: var(--secondary-text);
            border-radius: 50%;
            opacity: 0.5;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            padding: 0;
        }

        .scroll-marker.active {
            background-color: var(--accent);
            opacity: 1;
            transform: scale(1.3);
        }

        .scroll-marker:hover {
            opacity: 0.8;
            transform: scale(1.1);
        }

        /* Upload Section */
        .upload-section {
            background: var(--secondary-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
        }

        .upload-section:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .upload-label {
            display: block;
            text-align: center;
            padding: 1.5rem;
            border: 2px dashed var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-label:hover {
            border-color: var(--accent);
            background: var(--tertiary-bg);
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .upload-text {
            font-size: 1rem;
            color: var(--secondary-text);
        }

        .upload-error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        /* Instructions */
        .instructions {
            background: var(--secondary-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: var(--card-shadow);
        }

        .instructions h3 {
            margin-bottom: 1rem;
            color: var(--accent);
        }

        .instructions ul {
            padding-left: 1.5rem;
        }

        .instructions li {
            margin-bottom: 0.5rem;
            color: var(--secondary-text);
        }

        /* Fullscreen Overlay */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            cursor: zoom-out;
        }

        .fullscreen-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .fullscreen-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .fullscreen-overlay.active .fullscreen-image {
            transform: scale(1);
        }

        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: var(--tertiary-bg);
            color: var(--primary-text);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .fullscreen-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        /* Browser Support Notice */
        .browser-notice {
            background: var(--tertiary-bg);
            border-left: 4px solid var(--accent);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 2rem;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        /* Fade-in Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            
            .card {
                flex: 0 0 100%; /* Full width of container */
            }
            
            .carousel {
                padding: 1rem 0; /* Remove horizontal padding */
                gap: 0; /* Remove gap to prevent peeking */
                scroll-snap-stop: always;
            }
            
            .carousel-container {
                border-radius: 0; /* Optional: remove rounded corners for full bleed */
                margin-left: -0.5rem;
                margin-right: -0.5rem;
                width: calc(100% + 1rem); /* Compensate for body padding */
            }
            
            .scroll-btn {
                display: none; /* Hide on mobile, rely on swipe */
            }
            
            .card {
                border-radius: 0; /* Square edges on mobile */
            }
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .carousel {
                scroll-behavior: auto;
            }
        }
    </style>
</head>
<body>
    <input type="checkbox" id="theme-switch" aria-label="Toggle dark/light mode">
    
    <header>
        <div class="logo">CSS Carousel</div>
        <label for="theme-switch" class="theme-toggle" role="switch" aria-checked="false"></label>
    </header>
    
    <div class="container">
        <section class="title-section fade-in">
            <h1>Modern CSS Carousel</h1>
            <p>Built with scroll snapping, smooth animations, and touch gestures</p>
        </section>
        
        <section class="carousel-container fade-in">
            <div class="carousel" id="carousel" role="region" aria-label="Image carousel" tabindex="0">
                <button class="scroll-btn scroll-btn-left visible" id="scroll-left" aria-label="Scroll left">â€¹</button>
                <button class="scroll-btn scroll-btn-right visible" id="scroll-right" aria-label="Scroll right">â€º</button>
                
                <div class="card" role="group" aria-label="Card 1 of 5">
                    <div class="card-image-container">
                        <img src="https://picsum.photos/600/400?random=1" alt="Mountain landscape" class="card-image">
                        <button class="delete-btn" aria-label="Delete photo">Ã—</button>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Mountain Adventure</h3>
                        <p class="card-description">Explore breathtaking mountain ranges with stunning views and fresh air.</p>
                        <div class="card-tags">
                            <span class="tag">Outdoor</span>
                            <span class="tag">Hiking</span>
                        </div>
                    </div>
                </div>
                
                <div class="card" role="group" aria-label="Card 2 of 5">
                    <div class="card-image-container">
                        <img src="https://picsum.photos/600/400?random=2" alt="City skyline" class="card-image">
                        <button class="delete-btn" aria-label="Delete photo">Ã—</button>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Urban Exploration</h3>
                        <p class="card-description">Discover the vibrant energy of city life and architectural marvels.</p>
                        <div class="card-tags">
                            <span class="tag">City</span>
                            <span class="tag">Architecture</span>
                        </div>
                    </div>
                </div>
                
                <div class="card" role="group" aria-label="Card 3 of 5">
                    <div class="card-image-container">
                        <img src="https://picsum.photos/600/400?random=3" alt="Beach scene" class="card-image">
                        <button class="delete-btn" aria-label="Delete photo">Ã—</button>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Beach Getaway</h3>
                        <p class="card-description">Relax on pristine sandy beaches with crystal clear waters.</p>
                        <div class="card-tags">
                            <span class="tag">Beach</span>
                            <span class="tag">Relaxation</span>
                        </div>
                    </div>
                </div>
                
                <div class="card" role="group" aria-label="Card 4 of 5">
                    <div class="card-image-container">
                        <img src="https://picsum.photos/600/400?random=4" alt="Forest path" class="card-image">
                        <button class="delete-btn" aria-label="Delete photo">Ã—</button>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Forest Retreat</h3>
                        <p class="card-description">Immerse yourself in the tranquility of lush green forests.</p>
                        <div class="card-tags">
                            <span class="tag">Nature</span>
                            <span class="tag">Peaceful</span>
                        </div>
                    </div>
                </div>
                
                <div class="card" role="group" aria-label="Card 5 of 5">
                    <div class="card-image-container">
                        <img src="https://picsum.photos/600/400?random=5" alt="Desert landscape" class="card-image">
                        <button class="delete-btn" aria-label="Delete photo">Ã—</button>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">Desert Journey</h3>
                        <p class="card-description">Experience the vast beauty and solitude of desert landscapes.</p>
                        <div class="card-tags">
                            <span class="tag">Adventure</span>
                            <span class="tag">Extreme</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="scroll-markers" id="scroll-markers"></div>
        </section>
        
        <section class="upload-section fade-in">
            <label for="file-upload" class="upload-label">
                <span class="upload-icon">ðŸ“·</span>
                <span class="upload-text">Tap to upload photos from your gallery (Max 5MB each, 10 total)</span>
            </label>
            <input type="file" id="file-upload" accept="image/*" multiple style="display: none;" aria-label="Upload photos">
            <div class="upload-error" id="upload-error"></div>
        </section>
        
        <section class="instructions fade-in">
            <h3>How this carousel works</h3>
            <ul>
                <li>Scroll horizontally, swipe, or use arrow buttons to navigate</li>
                <li>Click any image to view fullscreen</li>
                <li>Long-press a card (mobile) or hover (desktop) to reveal delete button</li>
                <li>Upload up to 10 photos at once (5MB max each)</li>
                <li>Uses scroll snapping for precise card alignment</li>
                <li>Toggle between dark and light mode</li>
            </ul>
        </section>
        
        <div class="browser-notice fade-in">
            <strong>Note:</strong> Optimized for all modern browsers with touch gesture support.
        </div>
    </div>

    <!-- Fullscreen Overlay -->
    <div class="fullscreen-overlay" id="fullscreen-overlay" role="dialog" aria-modal="true" aria-label="Fullscreen image viewer">
        <button class="fullscreen-close" aria-label="Close fullscreen">Ã—</button>
        <img src="" alt="" class="fullscreen-image" id="fullscreen-image">
    </div>

    <script>
        // Theme toggle functionality
        const themeSwitch = document.getElementById('theme-switch');
        const body = document.body;
        const themeToggleLabel = document.querySelector('.theme-toggle');
        
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'light' || (!savedTheme && !prefersDark)) {
            themeSwitch.checked = true;
            body.classList.add('light-mode');
            themeToggleLabel.setAttribute('aria-checked', 'true');
        } else {
            themeToggleLabel.setAttribute('aria-checked', 'false');
        }
        
        themeSwitch.addEventListener('change', function() {
            if (this.checked) {
                body.classList.add('light-mode');
                localStorage.setItem('theme', 'light');
                themeToggleLabel.setAttribute('aria-checked', 'true');
            } else {
                body.classList.remove('light-mode');
                localStorage.setItem('theme', 'dark');
                themeToggleLabel.setAttribute('aria-checked', 'false');
            }
        });

        // Carousel functionality
        const carousel = document.getElementById('carousel');
        const scrollLeftBtn = document.getElementById('scroll-left');
        const scrollRightBtn = document.getElementById('scroll-right');
        const scrollMarkers = document.getElementById('scroll-markers');
        
        let cardCount = carousel.querySelectorAll('.card').length;
        let isScrolling = false;
        let longPressTimer = null;

        // Update scroll buttons state
        function updateScrollButtons() {
            const maxScroll = carousel.scrollWidth - carousel.clientWidth;
            scrollLeftBtn.disabled = carousel.scrollLeft <= 0;
            scrollRightBtn.disabled = carousel.scrollLeft >= maxScroll - 1;
            
            // Update markers
            const markers = scrollMarkers.querySelectorAll('.scroll-marker');
            const cardWidth = carousel.querySelector('.card').offsetWidth;
            const currentIndex = Math.round(carousel.scrollLeft / (cardWidth + 1)); // +1 for gap
            
            markers.forEach((marker, index) => {
                marker.classList.toggle('active', index === currentIndex);
            });
        }

        // Scroll buttons
        scrollLeftBtn.addEventListener('click', () => {
            const cardWidth = carousel.querySelector('.card').offsetWidth + 16; // card + gap
            carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
        });

        scrollRightBtn.addEventListener('click', () => {
            const cardWidth = carousel.querySelector('.card').offsetWidth + 16;
            carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
        });

        // Create scroll markers
        function createMarkers() {
            scrollMarkers.innerHTML = '';
            for (let i = 0; i < cardCount; i++) {
                const marker = document.createElement('button');
                marker.className = 'scroll-marker';
                marker.setAttribute('aria-label', `Go to card ${i + 1}`);
                marker.addEventListener('click', () => {
                    const card = carousel.querySelectorAll('.card')[i];
                    card.scrollIntoView({ behavior: 'smooth', inline: 'start' });
                });
                scrollMarkers.appendChild(marker);
            }
        }

        // Debounced scroll handler
        let scrollTimeout;
        carousel.addEventListener('scroll', () => {
            if (scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                updateScrollButtons();
                isScrolling = false;
            }, 100);
            isScrolling = true;
        }, { passive: true });

        // Keyboard navigation for carousel
        carousel.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                scrollLeftBtn.click();
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                scrollRightBtn.click();
            } else if (e.key === 'Home') {
                carousel.scrollTo({ left: 0, behavior: 'smooth' });
            } else if (e.key === 'End') {
                carousel.scrollTo({ left: carousel.scrollWidth, behavior: 'smooth' });
            }
        });

        // Touch swipe support
        let touchStartX = 0;
        let touchEndX = 0;

        carousel.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        carousel.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    scrollRightBtn.click(); // Swiped left, go next
                } else {
                    scrollLeftBtn.click(); // Swiped right, go prev
                }
            }
        }

        // Fullscreen functionality
        const fullscreenOverlay = document.getElementById('fullscreen-overlay');
        const fullscreenImage = document.getElementById('fullscreen-image');
        const fullscreenClose = document.querySelector('.fullscreen-close');

        function openFullscreen(img) {
            fullscreenImage.src = img.src;
            fullscreenImage.alt = img.alt;
            fullscreenOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeFullscreen() {
            fullscreenOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        fullscreenOverlay.addEventListener('click', (e) => {
            if (e.target === fullscreenOverlay || e.target === fullscreenClose) {
                closeFullscreen();
            }
        });

        fullscreenClose.addEventListener('click', closeFullscreen);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFullscreen();
            }
        });

        // Handle image clicks
        carousel.addEventListener('click', (e) => {
            const img = e.target.closest('.card-image');
            if (img) {
                openFullscreen(img);
            }
        });

        // Delete functionality
        function addDeleteListener(btn) {
            const card = btn.closest('.card');
            
            // Desktop: Use hover
            card.addEventListener('mouseenter', () => {
                if (window.innerWidth > 768) {
                    btn.style.opacity = '1';
                    btn.style.transform = 'scale(1)';
                }
            });
            
            card.addEventListener('mouseleave', () => {
                if (window.innerWidth > 768 && !btn.dataset.longPress) {
                    btn.style.opacity = '0';
                    btn.style.transform = 'scale(0.8)';
                }
            });
            
            // Mobile: Long press (500ms)
            let touchTimer;
            
            card.addEventListener('touchstart', (e) => {
                if (window.innerWidth <= 768) {
                    touchTimer = setTimeout(() => {
                        btn.style.opacity = '1';
                        btn.style.transform = 'scale(1)';
                        btn.dataset.longPress = 'true';
                        
                        // Hide after 3 seconds
                        setTimeout(() => {
                            if (!btn.matches(':active')) {
                                btn.style.opacity = '0';
                                btn.style.transform = 'scale(0.8)';
                                delete btn.dataset.longPress;
                            }
                        }, 3000);
                    }, 500);
                }
            }, { passive: true });
            
            card.addEventListener('touchend', () => {
                clearTimeout(touchTimer);
            });
            
            card.addEventListener('touchmove', () => {
                clearTimeout(touchTimer);
            });
            
            // Delete action
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (confirm('Delete this photo?')) {
                    card.style.transform = 'scale(0.8)';
                    card.style.opacity = '0';
                    
                    setTimeout(() => {
                        card.remove();
                        cardCount--;
                        createMarkers();
                        updateScrollButtons();
                    }, 300);
                }
            });
        }

        // Add delete listeners to existing cards
        document.querySelectorAll('.delete-btn').forEach(addDeleteListener);

        // File upload functionality
        const fileInput = document.getElementById('file-upload');
        const uploadError = document.getElementById('upload-error');

        fileInput.addEventListener('change', function(e) {
            const files = e.target.files;
            uploadError.style.display = 'none';
            uploadError.textContent = '';

            if (files.length > 10) {
                uploadError.textContent = 'Please select a maximum of 10 photos at once.';
                uploadError.style.display = 'block';
                return;
            }

            const currentCardCount = carousel.querySelectorAll('.card').length;
            if (currentCardCount + files.length > 20) {
                uploadError.textContent = 'Maximum 20 photos allowed. Please delete some photos first.';
                uploadError.style.display = 'block';
                return;
            }

            Array.from(files).forEach((file, index) => {
                if (!file.type.startsWith('image/')) {
                    uploadError.textContent = `${file.name} is not a valid image file.`;
                    uploadError.style.display = 'block';
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    uploadError.textContent = `${file.name} is too large. Maximum file size is 5MB.`;
                    uploadError.style.display = 'block';
                    return;
                }

                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const card = document.createElement('div');
                    card.className = 'card fade-in';
                    card.style.animationDelay = `${index * 0.1}s`;
                    
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'card-image-container';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.alt = 'Uploaded photo';
                    img.className = 'card-image';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = 'Ã—';
                    deleteBtn.setAttribute('aria-label', 'Delete photo');
                    addDeleteListener(deleteBtn);
                    
                    imgContainer.appendChild(img);
                    imgContainer.appendChild(deleteBtn);
                    
                    const cardContent = document.createElement('div');
                    cardContent.className = 'card-content';
                    
                    const title = document.createElement('h3');
                    title.className = 'card-title';
                    title.textContent = 'Your Photo';
                    
                    const description = document.createElement('p');
                    description.className = 'card-description';
                    description.textContent = 'This photo was uploaded from your device.';
                    
                    const tags = document.createElement('div');
                    tags.className = 'card-tags';
                    
                    const tag = document.createElement('span');
                    tag.className = 'tag';
                    tag.textContent = 'Uploaded';
                    
                    tags.appendChild(tag);
                    cardContent.appendChild(title);
                    cardContent.appendChild(description);
                    cardContent.appendChild(tags);
                    
                    card.appendChild(imgContainer);
                    card.appendChild(cardContent);
                    carousel.appendChild(card);
                    
                    setTimeout(() => {
                        cardCount++;
                        createMarkers();
                        updateScrollButtons();
                        card.scrollIntoView({ behavior: 'smooth', inline: 'start' });
                    }, 100);
                };
                
                reader.onerror = function() {
                    uploadError.textContent = `Error reading ${file.name}. Please try again.`;
                    uploadError.style.display = 'block';
                };
                
                reader.readAsDataURL(file);
            });
            
            this.value = '';
        });

        // Initialize
        createMarkers();
        updateScrollButtons();

        // Update on resize
        window.addEventListener('resize', () => {
            createMarkers();
            updateScrollButtons();
        });
    </script>
</body>
</html>