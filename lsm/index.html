<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advanced LocalStorage Manager</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    input, button, textarea {
        width: 100%;
        padding: 12px;
        margin: 6px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
    }
    button {
        cursor: pointer;
        background: #4CAF50;
        color: white;
        border: none;
    }
    button:hover {
        opacity: 0.9;
    }
    .danger {
        background: #d32f2f;
    }
    .secondary {
        background: #0277bd;
    }
    .key-row {
        background: white;
        margin: 8px 0;
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .key-title {
        font-weight: bold;
        font-size: 18px;
    }
    .size-small { color: #2e7d32; }
    .size-medium { color: #f9a825; }
    .size-large { color: #c62828; font-weight: bold; }
    #jsonExport {
        height: 150px;
        resize: vertical;
    }
</style>
</head>
<body>

<h2>Advanced LocalStorage Manager</h2>

<!-- Search Filter -->
<input type="text" id="searchBox" placeholder="Search keys..." oninput="renderKeys()">

<!-- Storage Summary -->
<div id="storageSummary"></div>

<!-- Keys List -->
<div id="keysContainer"></div>

<hr>

<!-- JSON Export -->
<h3>Backup & Restore</h3>
<button class="secondary" onclick="exportJSON()">Export LocalStorage as JSON</button>
<textarea id="jsonExport" placeholder="Exported JSON will appear here..."></textarea>

<button class="secondary" onclick="importJSON()">Import / Restore JSON</button>

<hr>

<!-- Clear All -->
<button class="danger" onclick="clearAll()">Clear ALL LocalStorage</button>

<script>
// ---------- Utilities ----------

function getSize(str) {
    if (!str) return 0;
    return new Blob([str]).size;
}

function getReadableSize(bytes) {
    if (bytes < 1024) return bytes + " B";
    return (bytes/1024).toFixed(2) + " KB";
}

// ---------- Render All Keys ----------

function renderKeys() {
    const container = document.getElementById("keysContainer");
    const search = document.getElementById("searchBox").value.toLowerCase();
    container.innerHTML = "";

    let totalBytes = 0;
    const entries = [];

    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const value = localStorage.getItem(key);
        const size = getSize(value);

        if (search && !key.toLowerCase().includes(search)) continue;

        totalBytes += size;

        entries.push({ key, value, size });
    }

    updateSummary(totalBytes);

    entries.forEach(entry => {
        const div = document.createElement("div");
        div.className = "key-row";

        let sizeClass = entry.size < 2000 ? "size-small" :
                        entry.size < 10000 ? "size-medium" : "size-large";

        div.innerHTML = `
            <div class="key-title">${entry.key}</div>
            <div class="${sizeClass}">Size: ${getReadableSize(entry.size)}</div>
            <textarea style="width:100%; margin-top:8px;" id="edit-${entry.key}">${entry.value}</textarea>
            <button onclick="saveKey('${entry.key}')">Save</button>
            <button class="danger" onclick="deleteKey('${entry.key}')">Delete</button>
        `;

        container.appendChild(div);
    });

    if (entries.length === 0) {
        container.innerHTML = "<p>No matching keys found.</p>";
    }
}

// ---------- Summary ----------

function updateSummary(totalBytes) {
    document.getElementById("storageSummary").innerHTML = `
        <h3>Total Storage Used: ${getReadableSize(totalBytes)}</h3>
    `;
}

// ---------- Edit Key ----------

function saveKey(key) {
    const newVal = document.getElementById("edit-" + key).value;
    localStorage.setItem(key, newVal);
    alert("Saved!");
    renderKeys();
}

// ---------- Delete Key ----------

function deleteKey(key) {
    if (confirm("Delete key: " + key + "?")) {
        localStorage.removeItem(key);
        renderKeys();
    }
}

// ---------- Clear All ----------

function clearAll() {
    if (confirm("âš  This will DELETE ALL LocalStorage. Continue?")) {
        localStorage.clear();
        renderKeys();
    }
}

// ---------- Export / Import JSON ----------

function exportJSON() {
    const exportObj = {};

    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        exportObj[key] = localStorage.getItem(key);
    }

    document.getElementById("jsonExport").value = JSON.stringify(exportObj, null, 2);
}

function importJSON() {
    try {
        const json = JSON.parse(document.getElementById("jsonExport").value);

        for (let key in json) {
            localStorage.setItem(key, json[key]);
        }

        alert("JSON imported successfully!");
        renderKeys();
    } catch (e) {
        alert("Invalid JSON!");
    }
}


// ---------- Initial Render ----------
renderKeys();

</script>

</body>
</html>
