<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hours Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c2c54;
            color: white;
            margin: 0;
            padding: 20px;
            overflow-x: hidden; /* Prevent horizontal scrolling */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #1e1e3f;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .chart-title {
            text-align: left;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .chart {
            display: flex;
            align-items: flex-end;
            height: 300px;
            background: #1e1e3f;
            border-left: 2px solid #444;
            border-bottom: 2px solid #444;
            padding: 0 10px;
            position: relative;
            overflow: hidden; /* Ensure bars do not spill outside */
        }

        .y-axis {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }

        .bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 0 1px; /* Reduced gap between bars */
        }

        .bar {
            width: 100%;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 0; /* Allow bars with zero height */
        }

        .bar.red { background: linear-gradient(to top, #d63384, #f78ca0); }
        .bar.orange { background: linear-gradient(to top, #f59e0b, #f9c74f); }
        .bar.green { background: linear-gradient(to top, #10b981, #38d9a9); }

        .bar-label {
            margin-top: 5px;
            font-size: 12px;
            color: #888;
            text-align: center;
            transform: rotate(-90deg); /* Rotate day and date labels */
            transform-origin: center;
            white-space: nowrap;
        }

        .bar-date {
            font-weight: bold;
        }

        .bar-time {
            color: #bbb;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #888;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #1e1e3f;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .file-input-label:hover {
            background: #f59e0b;
        }

        .summary {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .chart {
                height: auto;
                flex-direction: column;
            }

            .bar-wrapper {
                flex-direction: row;
                justify-content: center;
                margin: 5px 0;
            }

            .bar-label {
                transform: none;
                margin-top: 0;
                margin-left: 5px;
            }

            .y-axis {
                position: static;
                height: 100%;
                width: auto;
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-end;
            }

            .y-axis span {
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-title">Jeff's Hours</div>
        <div class="controls">
            <div class="file-input-wrapper">
                <input type="file" id="csvFile" accept=".csv">
                <label for="csvFile" class="file-input-label">üìÅ Import CSV</label>
            </div>
        </div>
        <div class="chart" id="chart">
            <div class="y-axis">
                <span>8h</span>
                <span>6h</span>
                <span>4h</span>
                <span>2h</span>
                <span>0h</span>
            </div>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(to top, #d63384, #f78ca0);"></div>
                <span>0-2 hours</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(to top, #f59e0b, #f9c74f);"></div>
                <span>3-5 hours</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(to top, #10b981, #38d9a9);"></div>
                <span>6-8 hours</span>
            </div>
        </div>
        <div class="summary" id="summary">
            <!-- Summary will be displayed here -->
        </div>
    </div>

    <script>
        window.addEventListener('resize', renderChart);

        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                parseCSV(event.target.result);
            };
            reader.readAsText(file);
        });

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const data = [];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const parts = line.split(',');
                if (parts.length >= 2) {
                    const date = parts[0].trim();
                    const time = parts[1].trim();

                    // Validate date and time
                    if (isValidDate(date) && isValidTime(time)) {
                        data.push({
                            date: date,
                            time: time,
                            timestamp: new Date(date).getTime()
                        });
                    }
                }
            }

            // Sort by date
            data.sort((a, b) => a.timestamp - b.timestamp);

            renderChart(data);
        }

        function isValidDate(dateString) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            return regex.test(dateString);
        }

        function isValidTime(timeString) {
            const regex = /^\d{1,2}:\d{2}$/;
            return regex.test(timeString);
        }

        function renderChart(data) {
            const chart = document.getElementById('chart');
            const existingBars = chart.querySelectorAll('.bar-wrapper');
            existingBars.forEach(bar => bar.remove());

            if (data.length === 0) {
                return;
            }

            const dates = new Set(data.map(item => item.date));
            const totalBars = 30; // Always show 30 days
            const chartWidth = chart.clientWidth;
            const barWidth = (chartWidth - (totalBars - 1) * 2) / totalBars; // Calculate bar width

            dates.forEach((date, index) => {
                const time = data.find(item => item.date === date)?.time || '0:00';
                const barWrapper = document.createElement('div');
                barWrapper.className = 'bar-wrapper';
                barWrapper.style.width = `${barWidth}px`; // Set bar width

                // Parse time
                const [hours, minutes] = time.split(':').map(Number);
                const totalHours = hours + (minutes / 60);

                // Create bar
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = (totalHours / 8) * 300; // 8 hours max
                bar.style.height = `${height}px`;

                // Set color based on hours
                if (totalHours <= 2) {
                    bar.classList.add('red');
                } else if (totalHours <= 5) {
                    bar.classList.add('orange');
                } else {
                    bar.classList.add('green');
                }

                // Create labels
                const label = document.createElement('div');
                label.className = 'bar-label';
                
                const dateObj = new Date(date);
                const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                const dayDate = dateObj.getDate();

                label.innerHTML = `${dayName} ${dayDate}`; // Day and date on the same line

                barWrapper.appendChild(bar);
                barWrapper.appendChild(label);
                chart.appendChild(barWrapper);
            });

            updateSummary(data);
        }

        function updateSummary(data) {
            let totalMinutes = 0;
            let totalDays = data.length;

            data.forEach(item => {
                const [hours, minutes] = item.time.split(':').map(Number);
                totalMinutes += hours * 60 + minutes;
            });

            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;
            const avgMinutes = totalDays > 0 ? Math.round(totalMinutes / totalDays) : 0;
            const avgHours = Math.floor(avgMinutes / 60);
            const avgMins = avgMinutes % 60;

            const summary = document.getElementById('summary');
            summary.innerHTML = `
                Total Hours: ${totalHours}h ${remainingMinutes}m
                Average per Day: ${avgHours}h ${avgMins}m
            `;
        }
    </script>
</body>
</html>