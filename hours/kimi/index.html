<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hours Tracker</title>
  <style>
    /* General body styling */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #0f0f1a, #131327);
      color: #c8c8ff;
    }
    /* Centered container with padding */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    /* Glassmorphic styling for the main content area */
    .glassmorphic {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
      padding: 20px;
      width: 100%;
      max-width: 800px;
    }
    /* Header styling with flexbox for alignment */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    /* Styling for the header title */
    .header h1 {
      font-size: clamp(1.8rem, 2.4rem, 3rem);
      font-weight: bold;
      margin: 0;
    }
    /* Button styling with hover effects */
    .header button {
      background: rgba(100, 140, 255, 0.18);
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 1rem;
      color: #c8c8ff;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .header button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(100, 140, 255, 0.5);
    }
    /* Chart container styling */
    .chart-container {
      position: relative;
      height: 520px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    .chart-container.mobile {
      height: 540px;
    }
    /* Y-axis labels styling */
    .y-axis {
      position: absolute;
      left: 0;
      top: 0;
      width: 50px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      color: #a0a0c0;
      text-align: right;
      padding-right: 10px;
    }
    /* Chart bars container */
    .chart {
      display: flex;
      align-items: flex-end;
      height: 100%;
      padding-left: 60px;
    }
    /* Individual bar styling */
    .bar {
      flex: 1;
      min-width: 24px;
      max-width: 56px;
      margin: 0 5px;
      position: relative;
      transition: height 0.6s cubic-bezier(0.215, 0.61, 0.355, 1);
    }
    /* Tooltip styling */
    .bar:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.82rem;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    /* X-axis labels styling */
    .x-axis {
      position: absolute;
      bottom: -150px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      font-size: 0.82rem;
      color: #c8c8ff;
    }
    /* Legend styling */
    .legend {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .legend-item div {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
    /* Summary box styling */
    .summary {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      font-size: 1.2rem;
    }
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .chart-container {
        height: 540px;
      }
      .x-axis {
        bottom: -180px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="glassmorphic">
      <div class="header">
        <h1 id="title">Hours Tracker</h1>
        <div>
          <button id="editTitle">✏️</button>
          <button id="importCSV">Import CSV</button>
          <button id="exportCSV" style="display: none;">Export CSV</button>
        </div>
      </div>
      <div class="chart-container">
        <div class="y-axis">
          <span id="yAxisTop">0h</span>
          <span>0h</span>
        </div>
        <div class="chart" id="chart"></div>
      </div>
      <div class="x-axis" id="xAxis"></div>
      <div class="legend">
        <div class="legend-item">
          <div style="background: linear-gradient(to top, #9c27b0, #e040fb);"></div>
          Low
        </div>
        <div class="legend-item">
          <div style="background: linear-gradient(to top, #ff9800, #ffc107);"></div>
          Medium
        </div>
        <div class="legend-item">
          <div style="background: linear-gradient(to top, #ffeb3b, #ffff00);"></div>
          High
        </div>
        <div class="legend-item">
          <div style="background: linear-gradient(to top, #43a047, #388e3c);"></div>
          Very High
        </div>
      </div>
      <div class="summary" id="summary"></div>
    </div>
  </div>
  <script>
    // Get references to DOM elements
    const titleElement = document.getElementById('title');
    const editTitleButton = document.getElementById('editTitle');
    const importCSVButton = document.getElementById('importCSV');
    const exportCSVButton = document.getElementById('exportCSV');
    const chartContainer = document.getElementById('chart');
    const yAxisTop = document.getElementById('yAxisTop');
    const xAxis = document.getElementById('xAxis');
    const summaryElement = document.getElementById('summary');

    // Data array to store parsed CSV data
    let data = [];

    // Function to save the title to localStorage
    function saveTitle() {
      localStorage.setItem('title', titleElement.textContent);
    }

    // Function to load the title from localStorage
    function loadTitle() {
      const savedTitle = localStorage.getItem('title');
      if (savedTitle) {
        titleElement.textContent = savedTitle;
      }
    }

    // Function to enable title editing
    function editTitle() {
      const currentTitle = titleElement.textContent;
      titleElement.textContent = '';
      const input = document.createElement('input');
      input.value = currentTitle;
      input.style.width = '100%';
      input.style.height = '100%';
      input.style.fontSize = 'clamp(1.8rem, 2.4rem, 3rem)';
      input.style.fontWeight = 'bold';
      input.style.color = '#c8c8ff';
      input.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
      input.style.border = 'none';
      input.style.outline = 'none';
      input.style.padding = '0';
      titleElement.appendChild(input);
      input.focus();
      input.addEventListener('blur', () => {
        titleElement.textContent = input.value;
        saveTitle();
      });
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          titleElement.textContent = input.value;
          saveTitle();
          input.blur();
        }
      });
    }

    // Function to handle CSV file import
    function importCSV(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;
        const rows = content.split('\n').slice(1); // Skip header row
        data = rows.map(row => {
          const [date, hours] = row.split(',');
          const [hoursNum, minutes] = hours.split(':');
          const totalHours = parseFloat(hoursNum) + parseFloat(minutes) / 60;
          return { date, hours: totalHours };
        });
        data.sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort by date
        renderChart(); // Render the chart with the new data
        exportCSVButton.style.display = 'inline-block'; // Show export button
      };
      reader.readAsText(file);
    }

    // Function to handle CSV file export
    function exportCSV() {
      const csvContent = data.map(d => `${d.date},${d.hours.toFixed(2)}`).join('\n');
      const blob = new Blob([`Date,Hours\n${csvContent}`], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      if (navigator.msSaveBlob) { // IE 10+
        navigator.msSaveBlob(blob, 'hours.csv');
      } else {
        const url = URL.createObjectURL(blob);
        link.href = url;
        link.download = 'hours.csv';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    // Function to render the chart based on the data
    function renderChart() {
      chartContainer.innerHTML = '';
      xAxis.innerHTML = '';
      let maxHours = Math.max(...data.map(d => d.hours)); // Find the maximum hours value
      yAxisTop.textContent = `${Math.ceil(maxHours)}h`; // Update the Y-axis top label

      data.forEach((d, index) => {
        const bar = document.createElement('div');
        bar.classList.add('bar');
        bar.style.height = `${(d.hours / maxHours) * 100}%`; // Scale bar height
        bar.style.background = getGradientColor(d.hours / maxHours); // Set gradient color
        bar.style.borderTopLeftRadius = '8px';
        bar.style.borderTopRightRadius = '8px';

        const tooltip = document.createElement('div');
        tooltip.classList.add('tooltip');
        tooltip.textContent = `${Math.floor(d.hours)}:${String(Math.round((d.hours % 1) * 60)).padStart(2, '0')} • ${d.hours.toFixed(2)}h`;
        bar.appendChild(tooltip);

        chartContainer.appendChild(bar);

        const label = document.createElement('div');
        label.textContent = new Date(d.date).toLocaleDateString('en-US', { weekday: 'short', day: 'numeric' });
        label.style.transform = 'rotate(-90deg)';
        xAxis.appendChild(label);
      });

      renderSummary(); // Render the summary box
    }

    // Function to get the gradient color based on the height ratio
    function getGradientColor(ratio) {
      if (ratio <= 0.25) return 'linear-gradient(to top, #9c27b0, #e040fb)';
      if (ratio <= 0.5) return 'linear-gradient(to top, #ff9800, #ffc107)';
      if (ratio <= 0.75) return 'linear-gradient(to top, #ffeb3b, #ffff00)';
      return 'linear-gradient(to top, #43a047, #388e3c)';
    }

    // Function to render the summary box
    function renderSummary() {
      const totalHours = data.reduce((acc, d) => acc + d.hours, 0);
      summaryElement.textContent = `Total Hours: ${totalHours.toFixed(2)}h`;
    }

    // Event listeners for buttons
    editTitleButton.addEventListener('click', editTitle);
    importCSVButton.addEventListener('change', importCSV);
    exportCSVButton.addEventListener('click', exportCSV);

    // Load the title from localStorage on page load
    loadTitle();
  </script>
</body>
</html>